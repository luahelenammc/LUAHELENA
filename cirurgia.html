<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cirurgia de Readequação Sexual – Multimarcos</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1, h2 {
      margin: 0 0 16px;
    }
    .chart-container {
      position: relative;
      display: inline-block;
      background-color: #111;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 40px;
    }
    .chart-flex {
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    /* Donut */
    .donut-chart {
      width: 300px;
      height: 300px;
    }
    .donut-chart .segment {
      fill: none;
      stroke-linecap: butt;
      cursor: pointer;
    }
    .donut-chart .background {
      fill: none;
      stroke: #222;
      stroke-width: 20;
      stroke-linecap: butt;
      cursor: default;
    }
    .donut-chart .pointer {
      fill: #fff;
      stroke: #000;
      stroke-width: 2;
      pointer-events: none;
    }
    /* Barra */
    .bar-chart {
      width: 300px;
      height: 50px;
      margin-top: 20px;
    }
    .bar-chart .segment-bar {
      cursor: pointer;
    }
    .bar-chart .pointer-bar {
      stroke: #fff;
      stroke-width: 2;
    }
    .legend {
      margin-left: 24px;
      text-align: left;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      font-size: 12px;
    }
    .swatch {
      width: 14px;
      height: 14px;
      display: inline-block;
      margin-right: 8px;
      border-radius: 2px;
    }
    /* tooltip customizado */
    #tooltip {
      position: absolute;
      background: rgba(255,255,255,0.9);
      color: #000;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      white-space: nowrap;
      display: none;
      transform: translate(-50%, -120%);
      z-index: 10;
    }
  </style>
</head>
<body>
  <h1>Cirurgia de Readequação Sexual</h1>

  <!-- Donut Chart -->
  <div class="chart-container" id="donut-container">
    <h2>Progresso Multimarcos (Donut)</h2>
    <div class="chart-flex">
      <svg class="donut-chart" viewBox="0 0 240 240">
        <circle class="background" cx="120" cy="120" r="90"></circle>
        <circle class="pointer" id="pointer" r="8" cx="120" cy="30"></circle>
      </svg>
      <div class="legend" id="legend"></div>
    </div>
    <div id="tooltip"></div>
  </div>

  <!-- Bar Chart -->
  <div class="chart-container" id="bar-container">
    <h2>Progresso Multimarcos (Barra)</h2>
    <svg class="bar-chart" viewBox="0 0 300 50">
      <!-- segmentos e ponteiro serão injetados -->
    </svg>
  </div>

  <script>
  (function(){
    // Marcos, rótulos e cores
    const markers = [
      new Date("2024-06-02T00:00:00"),
      new Date("2024-09-06T00:00:00"),
      new Date("2025-06-17T11:00:00"),
      new Date("2025-09-18T07:00:00"),
      new Date("2025-09-24T00:00:00"),
      new Date("2025-09-30T00:00:00"),
      new Date("2025-12-18T00:00:00")
    ];
    const labels = [
      "Descoberta da identidade trans",
      "Início da THF",
      "Consulta com Dr. Cury",
      "Cirurgia de redesignação (CRS)",
      "Alta hospitalar",
      "Desinchação final"
    ];
    const colors = [
      "#e6194b", "#3cb44b", "#ffe119",
      "#4363d8", "#f58231", "#911eb4"
    ];
    const totalDuration = markers[6] - markers[0];

    // Tooltip
    const tooltip = document.getElementById('tooltip');

    // --- DONUT SETUP ---
    const svgDonut = document.querySelector('.donut-chart');
    const cx = 120, cy = 120, radius = 90;
    const circumference = 2 * Math.PI * radius;
    let offset = 0;

    // draw donut segments
    labels.forEach((lab, i) => {
      const span = markers[i+1] - markers[i];
      const pct = span / totalDuration;
      const len = pct * circumference;
      const rest = circumference - len;

      const seg = document.createElementNS("http://www.w3.org/2000/svg","circle");
      seg.setAttribute("class","segment");
      seg.setAttribute("data-index", i);
      seg.setAttribute("cx", cx);
      seg.setAttribute("cy", cy);
      seg.setAttribute("r", radius);
      seg.setAttribute("stroke", colors[i]);
      seg.setAttribute("stroke-width", 20);
      seg.setAttribute("stroke-dasharray", `${len} ${rest}`);
      seg.setAttribute("stroke-dashoffset", -offset);
      seg.setAttribute("transform", `rotate(-90 ${cx} ${cy})`);
      // tooltip events
      seg.addEventListener('mouseenter', e => {
        tooltip.textContent = `${labels[i]} (${markers[i].toLocaleDateString()} → ${markers[i+1].toLocaleDateString()})`;
        tooltip.style.display = 'block';
      });
      seg.addEventListener('mousemove', e => {
        const r = svgDonut.getBoundingClientRect();
        tooltip.style.left = `${e.clientX - r.left}px`;
        tooltip.style.top  = `${e.clientY - r.top - 10}px`;
      });
      seg.addEventListener('mouseleave', () => tooltip.style.display = 'none');

      svgDonut.insertBefore(seg, document.getElementById('pointer'));
      offset += len;
    });

    // legend
    const legendDiv = document.getElementById('legend');
    labels.forEach((lab,i) => {
      const item = document.createElement('div');
      item.className = 'legend-item';
      item.innerHTML = `<span class="swatch" style="background:${colors[i]}"></span>${lab}`;
      legendDiv.appendChild(item);
    });

    // donut pointer
    const pointer = document.getElementById('pointer');
    function updatePointer() {
      let now = new Date(), elapsed = now - markers[0];
      if (elapsed < 0) elapsed = 0;
      if (elapsed > totalDuration) elapsed = totalDuration;
      const pct = elapsed / totalDuration;
      const ang = pct*2*Math.PI - Math.PI/2;
      pointer.setAttribute('cx', cx + radius*Math.cos(ang));
      pointer.setAttribute('cy', cy + radius*Math.sin(ang));
    }
    updatePointer(); setInterval(updatePointer,1000);

    // --- BAR SETUP ---
    const svgBar = document.querySelector('.bar-chart');
    const barWidth = 300;
    let barOffset = 0;

    // draw bar segments
    labels.forEach((lab,i) => {
      const span = markers[i+1] - markers[i];
      const pct = span / totalDuration;
      const w = pct * barWidth;

      const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
      rect.setAttribute("class","segment-bar");
      rect.setAttribute("x", barOffset);
      rect.setAttribute("y", 15);
      rect.setAttribute("width", w);
      rect.setAttribute("height", 20);
      rect.setAttribute("fill", colors[i]);
      // tooltip events
      rect.addEventListener('mouseenter', e => {
        tooltip.textContent = `${labels[i]} (${markers[i].toLocaleDateString()} → ${markers[i+1].toLocaleDateString()})`;
        tooltip.style.display = 'block';
      });
      rect.addEventListener('mousemove', e => {
        const r = svgBar.getBoundingClientRect();
        tooltip.style.left = `${e.clientX - r.left}px`;
        tooltip.style.top  = `${e.clientY - r.top - 10}px`;
      });
      rect.addEventListener('mouseleave', () => tooltip.style.display = 'none');

      svgBar.appendChild(rect);
      barOffset += w;
    });

    // bar pointer line
    const line = document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("class","pointer-bar");
    line.setAttribute("y1", 10);
    line.setAttribute("y2", 40);
    svgBar.appendChild(line);

    function updateBarPointer() {
      let now = new Date(), elapsed = now - markers[0];
      if (elapsed < 0) elapsed = 0;
      if (elapsed > totalDuration) elapsed = totalDuration;
      const pct = elapsed / totalDuration;
      const x = pct * barWidth;
      line.setAttribute("x1", x);
      line.setAttribute("x2", x);
    }

    updateBarPointer(); setInterval(updateBarPointer,1000);

  })();
  </script>
</body>
</html>
