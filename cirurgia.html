<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cirurgia de Readequação Sexual – Multimarcos</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1, h2 {
      margin: 0 0 16px;
    }
    .chart-container {
      position: relative;
      display: inline-block;
      background-color: #111;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 40px;
    }
    .chart-flex {
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    /* Donut */
    .donut-chart {
      width: 300px;
      height: 300px;
    }
    .donut-chart .background {
      fill: none;
      stroke: #222;
      stroke-width: 20;
      stroke-linecap: butt;
      cursor: default;
    }
    .donut-chart .segment {
      fill: none;
      stroke-linecap: butt;
      stroke-width: 20;
      cursor: pointer;
    }
    .donut-chart .pointer-line {
      stroke: #fff;
      stroke-width: 2;
      pointer-events: none;
    }
    /* Barra */
    .bar-chart {
      width: 300px;
      height: 50px;
    }
    .bar-chart .segment-bar {
      cursor: pointer;
    }
    .bar-chart .pointer-bar {
      stroke: #fff;
      stroke-width: 2;
    }
    .legend {
      margin-left: 24px;
      text-align: left;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      font-size: 12px;
    }
    .swatch {
      width: 14px;
      height: 14px;
      margin-right: 8px;
      border-radius: 2px;
      display: inline-block;
    }
    /* tooltip */
    #tooltip {
      position: absolute;
      background: rgba(255,255,255,0.9);
      color: #000;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      white-space: nowrap;
      display: none;
      transform: translate(-50%, -120%);
      z-index: 10;
    }
  </style>
</head>
<body>
  <h1>Cirurgia de Readequação Sexual</h1>

  <!-- Donut Chart -->
  <div class="chart-container">
    <h2>Progresso Multimarcos (Donut)</h2>
    <div class="chart-flex">
      <svg class="donut-chart" viewBox="0 0 240 240">
        <!-- fundo -->
        <circle class="background" cx="120" cy="120" r="90"></circle>
        <!-- segmentos injetados via JS -->
        <!-- ponteiro de hoje como linha -->
        <line id="pointerLine" class="pointer-line" x1="120" y1="40" x2="120" y2="-10"></line>
      </svg>
      <div class="legend" id="legend"></div>
    </div>
    <div id="tooltip"></div>
  </div>

  <!-- Bar Chart -->
  <div class="chart-container">
    <h2>Progresso Multimarcos (Barra)</h2>
    <svg class="bar-chart" viewBox="0 0 300 50"></svg>
  </div>

  <script>
  (function(){
    const markers = [
      new Date("2024-06-02T00:00:00"),
      new Date("2024-09-06T00:00:00"),
      new Date("2025-06-17T11:00:00"),
      new Date("2025-09-18T07:00:00"),
      new Date("2025-09-24T00:00:00"),
      new Date("2025-09-30T00:00:00"),
      new Date("2025-12-18T00:00:00")
    ];
    const labels = [
      "Descoberta da identidade trans",
      "Início da THF",
      "Consulta com Dr. Cury",
      "Cirurgia de redesignação (CRS)",
      "Alta hospitalar",
      "Desinchação final"
    ];
    const colors = [
      "#e6194b", "#3cb44b", "#ffe119",
      "#4363d8", "#f58231", "#911eb4"
    ];
    const totalDuration = markers[6] - markers[0];
    const tooltip = document.getElementById('tooltip');

    // DONUT
    const svgDonut = document.querySelector('.donut-chart');
    const cx = 120, cy = 120, radius = 90;
    const circumference = 2 * Math.PI * radius;
    let offset = 0;

    labels.forEach((lab,i) => {
      const span = markers[i+1] - markers[i];
      const segLen = (span/totalDuration)*circumference;
      const circle = document.createElementNS("http://www.w3.org/2000/svg","circle");
      circle.setAttribute("class","segment");
      circle.setAttribute("data-index", i);
      circle.setAttribute("cx", cx);
      circle.setAttribute("cy", cy);
      circle.setAttribute("r", radius);
      circle.setAttribute("stroke", colors[i]);
      circle.setAttribute("stroke-dasharray", `${segLen} ${circumference}`);
      circle.setAttribute("stroke-dashoffset", -offset);
      circle.setAttribute("transform", `rotate(-90 ${cx} ${cy})`);
      circle.addEventListener('mouseenter', e => {
        tooltip.textContent = `${labels[i]} (${markers[i].toLocaleDateString()} → ${markers[i+1].toLocaleDateString()})`;
        tooltip.style.display = 'block';
      });
      circle.addEventListener('mousemove', e => {
        const rect = svgDonut.getBoundingClientRect();
        tooltip.style.left = `${e.clientX - rect.left}px`;
        tooltip.style.top  = `${e.clientY - rect.top - 10}px`;
      });
      circle.addEventListener('mouseleave', () => tooltip.style.display = 'none');
      svgDonut.insertBefore(circle, document.getElementById('pointerLine'));
      offset += segLen;
    });

    // destacar CRS e Alta
    [3,4].forEach(idx => {
      const el = svgDonut.querySelector(`circle.segment[data-index="${idx}"]`);
      if (el) svgDonut.insertBefore(el, document.getElementById('pointerLine'));
    });

    // legenda
    const legendDiv = document.getElementById('legend');
    labels.forEach((lab,i) => {
      const item = document.createElement('div');
      item.className = 'legend-item';
      item.innerHTML = `<span class="swatch" style="background:${colors[i]}"></span>${lab}`;
      legendDiv.appendChild(item);
    });

    // pointer line
    const pointerLine = document.getElementById('pointerLine');
    function updatePointer() {
      let now = new Date(), elapsed = now - markers[0];
      elapsed = Math.max(0, Math.min(elapsed, totalDuration));
      const pct = elapsed/totalDuration;
      const angle = pct*2*Math.PI - Math.PI/2;
      const innerR = radius - 10;
      const outerR = radius + 20; // extend further out
      const x1 = cx + innerR * Math.cos(angle);
      const y1 = cy + innerR * Math.sin(angle);
      const x2 = cx + outerR * Math.cos(angle);
      const y2 = cy + outerR * Math.sin(angle);
      pointerLine.setAttribute('x1', x1);
      pointerLine.setAttribute('y1', y1);
      pointerLine.setAttribute('x2', x2);
      pointerLine.setAttribute('y2', y2);
    }
    updatePointer(); setInterval(updatePointer,1000);

    // BAR (mantido)
    const svgBar = document.querySelector('.bar-chart'), barW=300;
    let barOffset =0;
    labels.forEach((lab,i)=>{
      const span=markers[i+1]-markers[i];
      const w=(span/totalDuration)*barW;
      const rect=document.createElementNS("http://www.w3.org/2000/svg","rect");
      rect.setAttribute("x",barOffset);
      rect.setAttribute("y",15);
      rect.setAttribute("width",w);
      rect.setAttribute("height",20);
      rect.setAttribute("fill",colors[i]);
      rect.addEventListener('mouseenter',e=>{
        tooltip.textContent=`${labels[i]} (${markers[i].toLocaleDateString()} → ${markers[i+1].toLocaleDateString()})`;
        tooltip.style.display='block';
      });
      rect.addEventListener('mousemove',e=>{
        const r=svgBar.getBoundingClientRect();
        tooltip.style.left=`${e.clientX-r.left}px`;
        tooltip.style.top=`${e.clientY-r.top-10}px`;
      });
      rect.addEventListener('mouseleave',()=>tooltip.style.display='none');
      svgBar.appendChild(rect);
      barOffset+=w;
    });
    const line=document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("class","pointer-bar");
    line.setAttribute("y1",10);
    line.setAttribute("y2",40);
    svgBar.appendChild(line);
    function updateBar(){
      let now=new Date(),elapsed=now-markers[0];
      elapsed=Math.max(0,Math.min(elapsed,totalDuration));
      const x=(elapsed/totalDuration)*barW;
      line.setAttribute("x1",x);
      line.setAttribute("x2",x);
    }
    updateBar(); setInterval(updateBar,1000);
  })();
  </script>
</body>
</html>
