<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Controle de Doses · Mounjaro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* =========================
       RESET BÁSICO
    ========================== */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root{
      --bg-1:#0c1020;
      --bg-2:#050712;

      --accent-lime:#a6f277;
      --accent-cyan:#54d7ff;
      --accent-red:#ff4b4b;

      --text-main:#111217;
      --text-soft:#3b4055;
      --text-muted:#7a809a;
      --panel-bg:#f9fafc;

      --row-alt:#f0f3fa;
    }

    body{
      min-height:100vh;
      font-family:system-ui,-apple-system,"SF Pro Text","Segoe UI",Roboto,sans-serif;
      font-variant-numeric: tabular-nums;
      background:
        radial-gradient(circle at 0% 0%, rgba(84,215,255,0.2), transparent 60%),
        radial-gradient(circle at 100% 0%, rgba(166,242,119,0.18), transparent 60%),
        linear-gradient(145deg, var(--bg-1), var(--bg-2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:2rem 1.2rem;
      color:var(--text-main);
    }

    /* =========================
       JANELA ESTILO MAC OS X
    ========================== */
    .window{
      width:100%;
      max-width:980px;
      border-radius:14px;
      background:linear-gradient(to bottom,#fdfdff 0%,#f6f7fb 38%,#eceff6 100%);
      box-shadow:0 26px 60px rgba(0,0,0,0.65), 0 0 0 1px rgba(0,0,0,0.45);
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.7);
    }

    .window-titlebar{
      display:flex;
      align-items:center;
      padding:0.4rem 0.75rem;
      background:linear-gradient(to bottom,#fdfdff 0%,#f4f5fa 45%,#e0e3ee 100%);
      border-bottom:1px solid rgba(0,0,0,0.15);
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.9), 0 1px 0 rgba(255,255,255,0.8);
    }

    .window-buttons{ display:flex; gap:0.35rem; margin-right:0.6rem; }
    .window-button{
      width:12px; height:12px; border-radius:50%;
      border:1px solid rgba(0,0,0,0.25);
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.7), 0 0 0 1px rgba(255,255,255,0.4);
    }
    .window-button.close{ background:radial-gradient(circle at 30% 30%, #fffcf7, #ff5f57); }
    .window-button.minimize{ background:radial-gradient(circle at 30% 30%, #fffdf3, #febc2e); }
    .window-button.zoom{ background:radial-gradient(circle at 30% 30%, #f6fff6, #28c840); }

    .window-title{
      font-size:0.82rem;
      color:#555a70;
      text-shadow:0 1px 0 rgba(255,255,255,0.9);
    }

    .window-body{
      background:linear-gradient(to bottom,#f7f8fd 0%,#f3f4fb 45%,#e9edf7 100%);
      padding:1.1rem 1.4rem 1.4rem;
    }
    @media (max-width:720px){ .window-body{ padding-inline:0.9rem; } }

    /* =========================
       TOOLBAR
    ========================== */
    .toolbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
      margin-bottom:1rem;
      padding:0.55rem 0.7rem;
      border-radius:9px;
      background:linear-gradient(to bottom, rgba(255,255,255,0.9), rgba(246,248,255,0.9));
      border:1px solid rgba(0,0,0,0.08);
      box-shadow:0 1px 0 rgba(255,255,255,0.9), inset 0 1px 0 rgba(255,255,255,0.9);
    }

    .toolbar-main{ display:flex; flex-direction:column; gap:0.15rem; }
    .toolbar-title{
      font-size:1.05rem; font-weight:600; color:#272b3c;
      text-shadow:0 1px 0 rgba(255,255,255,0.9);
    }
    .toolbar-subtitle{ font-size:0.8rem; color:#707693; }

    /* linha de peso (gerada por JS) */
    .toolbar-weightline{
      margin-top:0.25rem;
      display:flex;
      flex-wrap:wrap;
      gap:0.35rem;
      align-items:center;
      font-size:0.78rem;
      color:#4b516a;
    }

    .weight-chip{
      display:inline-flex;
      align-items:center;
      gap:0.35rem;
      padding:0.12rem 0.5rem;
      border-radius:999px;
      border:1px solid rgba(0,0,0,0.08);
      background:linear-gradient(to bottom,#ffffff,#f2f6ff);
      box-shadow:0 1px 0 rgba(255,255,255,0.95), inset 0 1px 0 rgba(255,255,255,0.9);
      white-space:nowrap;
    }

    .weight-chip .dot{
      width:9px; height:9px; border-radius:999px;
      box-shadow:0 0 0 1px rgba(0,0,0,0.18);
      flex:0 0 auto;
    }

    .weight-chip strong{ color:#272b3c; font-weight:800; }

    /* destaque especial do peso atual */
    .weight-chip.current{
      border-color: rgba(123,165,91,0.55);
      background: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.95), rgba(166,242,119,0.18));
      box-shadow:
        0 8px 18px rgba(166,242,119,0.22),
        0 1px 0 rgba(255,255,255,0.95),
        inset 0 1px 0 rgba(255,255,255,0.9);
    }

    .badge-phase{
      display:inline-flex;
      align-items:center;
      gap:0.4rem;
      padding:0.25rem 0.65rem;
      border-radius:999px;
      font-size:0.72rem;
      border:1px solid rgba(0,0,0,0.08);
      background:linear-gradient(to bottom,#fdfefd,#f0f5ff);
      color:#384056;
      box-shadow:0 1px 0 rgba(255,255,255,0.9), inset 0 1px 0 rgba(255,255,255,0.9);
      white-space:nowrap;
    }
    .badge-dot{
      width:10px; height:10px; border-radius:999px;
      background:radial-gradient(circle at 30% 30%, #ffffff, #54d7ff);
      box-shadow:0 0 0 1px rgba(0,0,0,0.2);
    }

    /* =========================
       GRID PRINCIPAL
    ========================== */
    .layout-grid{
      display:grid;
      grid-template-columns: minmax(0, 1.15fr) minmax(0, 1.2fr);
      gap:1rem;
    }
    @media (max-width:880px){
      .layout-grid{ grid-template-columns: minmax(0,1fr); }
    }

    .panel{
      border-radius:10px;
      background:var(--panel-bg);
      border:1px solid rgba(0,0,0,0.05);
      box-shadow:0 1px 0 rgba(255,255,255,0.9), inset 0 1px 0 rgba(255,255,255,0.8);
      padding:0.9rem 0.9rem 1rem;
    }

    .panel-header{
      font-size:0.78rem;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:var(--text-muted);
      margin-bottom:0.6rem;
    }

    /* =========================
       STATS / RESUMO
    ========================== */
    .stats-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:0.6rem;
      margin-bottom:0.9rem;
    }
    @media (max-width:640px){
      .stats-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }

    .stat-card{
      border-radius:8px;
      background:linear-gradient(to bottom,#ffffff,#f0f4ff);
      border:1px solid rgba(0,0,0,0.04);
      box-shadow:0 1px 0 rgba(255,255,255,0.95), inset 0 1px 0 rgba(255,255,255,0.9);
      padding:0.6rem 0.7rem;
    }
    .stat-label{
      font-size:0.72rem;
      text-transform:uppercase;
      letter-spacing:0.14em;
      color:var(--text-muted);
      margin-bottom:0.15rem;
    }
    .stat-value{
      font-size:1.05rem;
      font-weight:600;
      color:#25293a;
      margin-bottom:0.12rem;
    }
    .stat-sub{ font-size:0.77rem; color:var(--text-soft); }

    /* mini interface das fases (novo) */
    .phase-ui{
      display:flex;
      flex-direction:column;
      gap:0.45rem;
      margin-top:0.25rem;
    }

    .phase-row{
      display:grid;
      grid-template-columns: auto 1fr auto;
      gap:0.45rem;
      align-items:center;
      padding:0.22rem 0.35rem;
      border-radius:7px;
      border:1px solid rgba(0,0,0,0.06);
      background:linear-gradient(to bottom, rgba(255,255,255,0.95), rgba(245,248,255,0.95));
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.9);
    }

    .phase-dot{
      width:10px; height:10px; border-radius:999px;
      box-shadow:0 0 0 1px rgba(0,0,0,0.18);
    }
    .phase-dot.cyan{ background:radial-gradient(circle at 30% 30%, #ffffff, var(--accent-cyan)); }
    .phase-dot.lime{ background:radial-gradient(circle at 30% 30%, #ffffff, var(--accent-lime)); }
    .phase-dot.red{  background:radial-gradient(circle at 30% 30%, #ffffff, var(--accent-red)); }

    .phase-text{
      font-size:0.78rem;
      color:#3b4055;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .phase-count{
      font-size:0.78rem;
      color:#2b2f3f;
      font-weight:700;
      padding-left:0.25rem;
      white-space:nowrap;
    }

    .phase-bar{
      grid-column: 1 / -1;
      height:7px;
      border-radius:999px;
      overflow:hidden;
      background:rgba(20,24,40,0.07);
      border:1px solid rgba(0,0,0,0.06);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
    }
    .phase-fill{
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(to right, rgba(84,215,255,0.85), rgba(166,242,119,0.85));
    }
    /* cores por fase */
    #phase-fill-25{  background:linear-gradient(to right, rgba(84,215,255,0.9), rgba(84,215,255,0.55)); }
    #phase-fill-375{ background:linear-gradient(to right, rgba(166,242,119,0.9), rgba(166,242,119,0.55)); }
    #phase-fill-5{   background:linear-gradient(to right, rgba(255,75,75,0.9), rgba(255,75,75,0.55)); }


    /* =========================
       BLOCO "PRÓXIMA DATA"
    ========================== */
    .next-block{
      display:grid;
      grid-template-columns: minmax(0,1fr);
      gap:0.7rem;
      align-items:stretch;
    }

    .next-card{
      border-radius:8px;
      background:linear-gradient(135deg,#fefefe 0%,#f3fbf0 45%,#e4f5d8 100%);
      border:1px solid rgba(144, 188, 120, 0.7);
      box-shadow:0 1px 0 rgba(255,255,255,0.9), inset 0 1px 0 rgba(255,255,255,0.9);
      padding:0.75rem 0.8rem;
      display:flex;
      flex-direction:column;
      gap:0.15rem;
    }
    .next-label{
      font-size:0.76rem;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:#627957;
    }
    .next-date{
      font-size:1.25rem;
      font-weight:700;
      color:#24301f;
    }
    .next-weekday{ font-size:0.9rem; color:#3c4e30; }
    .next-mg{ margin-top:0.15rem; font-size:0.86rem; color:#2c3a23; }
    .next-mg strong{ color:#1a5c1a; }
    #next-mg.mg-25{ color:#0a5f82; }
    #next-mg.mg-375{ color:#1a5c1a; }
    #next-mg.mg-5{ color:#b00000; }
    .next-countdown{ font-size:0.8rem; color:#5a6b4b; margin-top:0.15rem; }

    /* =========================
       TABELA
    ========================== */
    .table-wrapper{
      border-radius:8px;
      border:1px solid rgba(0,0,0,0.08);
      background:#ffffff;
      box-shadow:0 1px 0 rgba(255,255,255,0.95), inset 0 1px 0 rgba(255,255,255,0.9);
      overflow:hidden;
    }

    .dose-table{ width:100%; border-collapse:collapse; font-size:0.8rem; }

    .dose-table thead{
      background:linear-gradient(to bottom,#f7f8fd,#e9edf7);
    }

    .dose-table th{
      text-align:left;
      padding:0.45rem 0.6rem;
      font-weight:500;
      color:var(--text-soft);
      border-bottom:1px solid rgba(0,0,0,0.08);
    }

    .dose-table tbody tr:nth-child(odd){ background:#ffffff; }
    .dose-table tbody tr:nth-child(even){ background:var(--row-alt); }

    .dose-table td{
      padding:0.4rem 0.6rem;
      color:var(--text-soft);
      border-bottom:1px solid rgba(0,0,0,0.04);
      vertical-align:middle;
    }

    .dose-id{ font-weight:600; color:#252a3a; }

    .mg-pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:64px;
      padding:0.15rem 0.5rem;
      border-radius:999px;
      font-size:0.76rem;
      border:1px solid rgba(0,0,0,0.06);
      background:#fdfefe;
    }
    .mg-pill.mg-25{
      background:radial-gradient(circle at 30% 30%, #ffffff, var(--accent-cyan));
      border-color:rgba(71,143,173,0.7);
    }
    .mg-pill.mg-375{
      background:radial-gradient(circle at 30% 30%, #ffffff, var(--accent-lime));
      border-color:rgba(123,165,91,0.7);
    }
    .mg-pill.mg-5{
      background:radial-gradient(circle at 30% 30%, #ffffff, var(--accent-red));
      border-color:rgba(170,60,60,0.75);
    }


    .weekday-tag{
      display:inline-block;
      padding:0.08rem 0.4rem;
      border-radius:4px;
      font-size:0.75rem;
      border:1px solid rgba(0,0,0,0.06);
      background:#f6f8ff;
      color:var(--text-muted);
    }

    .note{ font-size:0.76rem; color:var(--text-muted); }

    .table-footer{
      padding:0.5rem 0.6rem;
      font-size:0.76rem;
      color:var(--text-muted);
      background:#f5f7fc;
      border-top:1px solid rgba(0,0,0,0.06);
    }

    .hint{
      margin-top:0.5rem;
      font-size:0.75rem;
      color:var(--text-muted);
    }

    .hint code{
      font-family: ui-monospace, Menlo, Consolas, "Liberation Mono", monospace;
      background:#e5e9f4;
      padding:0.05rem 0.25rem;
      border-radius:4px;
      border:1px solid rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="window">
    <div class="window-titlebar">
      <div class="window-buttons">
        <div class="window-button close"></div>
        <div class="window-button minimize"></div>
        <div class="window-button zoom"></div>
      </div>
      <div class="window-title">Controle de Doses · Mounjaro</div>
    </div>

    <div class="window-body">
      <div class="toolbar">
        <div class="toolbar-main">
          <div class="toolbar-title">Registro semanal de aplicações</div>
          <div class="toolbar-subtitle">
            Doses iniciais às quartas (2,5 mg) e fase atual às sextas (3,75 mg → 5 mg).
          </div>

          <!-- peso: tudo gerado por JS (zero número estático aqui) -->
          <div class="toolbar-weightline" id="weightline" aria-label="Resumo de pesos">
            <!-- JS preenche -->
          </div>
        </div>

        <div class="badge-phase">
          <span class="badge-dot"></span>
          <span id="badge-phase-text">–</span>
        </div>
      </div>

      <div class="layout-grid">
        <!-- COLUNA ESQUERDA: RESUMO + PRÓXIMA DATA -->
        <section class="panel">
          <div class="panel-header">Resumo</div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">Doses registradas</div>
              <div class="stat-value" id="stat-total-doses">–</div>
              <div class="stat-sub" id="stat-range">–</div>
            </div>

            <div class="stat-card">
              <div class="stat-label">Total aplicado</div>
              <div class="stat-value" id="stat-total-mg">–</div>
              <div class="stat-sub">mg acumulados</div>
            </div>

            <!-- NOVO: Por fase vira mini interface -->
            <div class="stat-card">
              <div class="stat-label">Por fase</div>

              <div class="phase-ui" aria-label="Distribuição de doses por fase">
                <div class="phase-row">
                  <span class="phase-dot cyan" aria-hidden="true"></span>
                  <div class="phase-text" id="phase-text-25">–</div>
                  <div class="phase-count" id="phase-count-25">–</div>
                  <div class="phase-bar" aria-hidden="true">
                    <div class="phase-fill" id="phase-fill-25"></div>
                  </div>
                </div>

                <div class="phase-row">
                  <span class="phase-dot lime" aria-hidden="true"></span>
                  <div class="phase-text" id="phase-text-375">–</div>
                  <div class="phase-count" id="phase-count-375">–</div>
                  <div class="phase-bar" aria-hidden="true">
                    <div class="phase-fill" id="phase-fill-375"></div>
                  </div>
                </div>

                <div class="phase-row">
                  <span class="phase-dot red" aria-hidden="true"></span>
                  <div class="phase-text" id="phase-text-5">–</div>
                  <div class="phase-count" id="phase-count-5">–</div>
                  <div class="phase-bar" aria-hidden="true">
                    <div class="phase-fill" id="phase-fill-5"></div>
                  </div>
                </div>
              </div>

              <div class="stat-sub" id="stat-phases-detail" style="margin-top:0.45rem;">–</div>
            </div>
          </div>

          <div class="next-block">
            <div class="next-card">
              <div class="next-label">Próxima data</div>
              <div class="next-date" id="next-date">–</div>
              <div class="next-weekday" id="next-weekday">–</div>
              <div class="next-mg">
                Dose prevista: <strong id="next-mg">–</strong>
              </div>
              <div class="next-countdown" id="next-countdown">–</div>
            </div>
          </div>

          <p class="hint">
            Para registrar novas aplicações, edite o array <code>doses</code> no JavaScript deste arquivo.
          </p>
        </section>

        <!-- COLUNA DIREITA: LISTA -->
        <section class="panel">
          <div class="panel-header">Doses registradas</div>

          <div class="table-wrapper">
            <table class="dose-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Data</th>
                  <th>Dia</th>
                  <th>Dosagem</th>
                  <th>Observação</th>
                </tr>
              </thead>
              <tbody id="dose-tbody"></tbody>
            </table>
            <div class="table-footer" id="table-footer">–</div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <script>
    // ====================================
    // ARRAY PRINCIPAL DE DOSES
    // ====================================
    const doses = [
      { id: 1, date: "2025-12-03", weekday: "quarta-feira", mg: 2.5,  note: "Dose inicial · fase 2,5 mg" },
      { id: 2, date: "2025-12-10", weekday: "quarta-feira", mg: 2.5,  note: "2ª quarta de 2,5 mg" },
      { id: 3, date: "2025-12-17", weekday: "quarta-feira", mg: 2.5,  note: "3ª quarta de 2,5 mg" },
      { id: 4, date: "2025-12-24", weekday: "quarta-feira", mg: 2.5,  note: "4ª quarta de 2,5 mg" },

      { id: 5, date: "2026-01-03", weekday: "sexta-feira",  mg: 3.75, note: "1ª dose de 3,75 mg (sexta)" },
      { id: 6, date: "2026-01-09", weekday: "sexta-feira",  mg: 5, note: "1ª dose de 5 mg (sexta)" }, 
         { id: 7, date: "2026-01-16", weekday: "sexta-feira",  mg: 5, note: "2ª dose de 5 mg (sexta)" },
         { id: 8, date: "2026-01-23", weekday: "sexta-feira",  mg: 5, note: "3ª dose de 5 mg (sexta)" },
         { id: 9, date: "2026-01-30", weekday: "sexta-feira",  mg: 5, note: "4ª dose de 5 mg (sexta)" },
               { id: 9, date: "2026-02-05", weekday: "sexta-feira",  mg: 4.41, note: "1ª dose de 4,41 mg (sexta)" }
    ];

    // ====================================
    // ARRAY DE PESOS (EDITÁVEL)
    // ====================================
    // Observações:
    // - "type: current" é o mais destacado visualmente.
    // - você pode mudar facilmente o peso atual aqui e ele reflete na interface.
    // - se quiser adicionar outros marcos, só inserir novos itens.
    const weights = [
      { type: "initial", label: "peso inicial",             kg: 104.0 },
      { type: "day30",   label: "peso depois de 30 dias",   kg: 98.5  },
      { type: "current", label: "peso atual",               kg: 95.0  }
    ];

    // ====================================
    // FUNÇÕES DE APOIO
    // ====================================
    function parseISO(dateStr){ return new Date(dateStr + "T12:00:00"); }

    function formatDatePtBR(dateStr){
      const [y,m,d] = dateStr.split("-");
      return `${d}/${m}/${y}`;
    }

    function formatMg(mg){ return mg.toString().replace(".", ",") + " mg"; }

    function mgClass(mg){
      if (mg === 2.5) return "mg-25";
      if (mg === 3.75) return "mg-375";
      if (mg === 5) return "mg-5";
      return "mg-unknown";
    }

    function formatKg(kg){
      const s = (Math.round(kg * 10) / 10).toString();
      return s.replace(".", ",") + " kg";
    }

    function diffDays(from, to){
      const msPerDay = 24 * 60 * 60 * 1000;
      const d1 = new Date(from.getFullYear(), from.getMonth(), from.getDate());
      const d2 = new Date(to.getFullYear(), to.getMonth(), to.getDate());
      return Math.round((d2 - d1) / msPerDay);
    }

    function nextWeeklyDateFrom(lastIsoDate){
      const d = parseISO(lastIsoDate);
      d.setDate(d.getDate() + 7);
      return d;
    }

    function weekdayPtBR(dateObj){
      const dias = ["domingo","segunda-feira","terça-feira","quarta-feira","quinta-feira","sexta-feira","sábado"];
      return dias[dateObj.getDay()];
    }

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    // ====================================
    // RENDER: PESOS (toolbar)
    // ====================================
    function renderWeights(){
      const host = document.getElementById("weightline");
      host.innerHTML = "";

      const initial = weights.find(w => w.type === "initial") || weights[0];
      const current = weights.find(w => w.type === "current") || weights[weights.length - 1];

      // fallback seguro
      const initialKg = initial?.kg ?? 0;
      const currentKg = current?.kg ?? 0;
      const delta = Math.round((currentKg - initialKg) * 10) / 10; // negativo = perda

      const dotByType = (type) => {
        if (type === "initial") return `radial-gradient(circle at 30% 30%, #ffffff, var(--accent-cyan))`;
        if (type === "current") return `radial-gradient(circle at 30% 30%, #ffffff, var(--accent-lime))`;
        return `radial-gradient(circle at 30% 30%, #ffffff, #c9cedf)`;
      };

      const mkChip = (w) => {
        const chip = document.createElement("span");
        chip.className = "weight-chip" + (w.type === "current" ? " current" : "");
        const dot = document.createElement("span");
        dot.className = "dot";
        dot.style.background = dotByType(w.type);

        const text = document.createElement("span");
        // label + valor
        text.innerHTML = `${w.label}: <strong>${formatKg(w.kg)}</strong>`;

        chip.appendChild(dot);
        chip.appendChild(text);
        return chip;
      };

      // chips na ordem do array
      weights.forEach(w => host.appendChild(mkChip(w)));

      // chip de variação automática (não é editado, é calculado)
      const deltaChip = document.createElement("span");
      deltaChip.className = "weight-chip";
      const deltaDot = document.createElement("span");
      deltaDot.className = "dot";
      deltaDot.style.background = `radial-gradient(circle at 30% 30%, #ffffff, #c9cedf)`;

      const sign = delta > 0 ? "+" : (delta < 0 ? "−" : "±");
      const abs = Math.abs(delta).toString().replace(".", ",");
      const deltaText = document.createElement("span");
      deltaText.innerHTML = `variação (início → atual): <strong>${sign}${abs} kg</strong>`;

      deltaChip.appendChild(deltaDot);
      deltaChip.appendChild(deltaText);
      host.appendChild(deltaChip);
    }

    // ====================================
    // RENDER: RESUMO / FASES / PRÓXIMA DATA
    // ====================================
    function renderSummary(){
      if (!doses.length) return;

      const totalDoses = doses.length;
      const totalMg = doses.reduce((sum, d) => sum + d.mg, 0);

      const first = doses[0];
      const last  = doses[doses.length - 1];

      const doses25  = doses.filter(d => d.mg === 2.5);
      const doses375 = doses.filter(d => d.mg === 3.75);
      const doses5   = doses.filter(d => d.mg === 5);

      // badge da fase atual (dinâmico)
      const badge = document.getElementById("badge-phase-text");
      badge.textContent = `Fase atual: ${last.weekday} · ${formatMg(last.mg)}`;

      // stats simples
      document.getElementById("stat-total-doses").textContent = totalDoses;
      document.getElementById("stat-range").textContent =
        `de ${formatDatePtBR(first.date)} até ${formatDatePtBR(last.date)}`;

      document.getElementById("stat-total-mg").textContent = formatMg(Number(totalMg.toFixed(2)));

      // mini interface por fase
      const c25 = doses25.length;
      const c375 = doses375.length;
      const c5 = doses5.length;
      const maxC = Math.max(c25, c375, c5, 1);

      document.getElementById("phase-text-25").textContent  = "2,5 mg · fase inicial (quartas)";
      document.getElementById("phase-count-25").textContent = `${c25}×`;
      document.getElementById("phase-fill-25").style.width  = `${clamp((c25 / maxC) * 100, 6, 100)}%`;

      document.getElementById("phase-text-375").textContent  = (last.mg === 3.75)
        ? "3,75 mg · fase atual (sextas)"
        : "3,75 mg · fase anterior (sextas)";
      document.getElementById("phase-count-375").textContent = `${c375}×`;
      document.getElementById("phase-fill-375").style.width  = `${clamp((c375 / maxC) * 100, 6, 100)}%`;

      document.getElementById("phase-text-5").textContent  = (last.mg === 5)
        ? "5 mg · fase atual (sextas)"
        : "5 mg · próxima fase (sextas)";
      document.getElementById("phase-count-5").textContent = `${c5}×`;
      document.getElementById("phase-fill-5").style.width  = `${clamp((c5 / maxC) * 100, 6, 100)}%`;

      document.getElementById("stat-phases-detail").textContent =
        `início em ${first.weekday} (${formatDatePtBR(first.date)}) · fase atual em ${last.weekday} (${formatMg(last.mg)})`;

      // próxima data
      const nextDateObj = nextWeeklyDateFrom(last.date);
      const dd = String(nextDateObj.getDate()).padStart(2, "0");
      const mm = String(nextDateObj.getMonth() + 1).padStart(2, "0");
      const yyyy = nextDateObj.getFullYear();

      document.getElementById("next-date").textContent = `${dd}/${mm}/${yyyy}`;
      document.getElementById("next-weekday").textContent = weekdayPtBR(nextDateObj);

      // regra: próxima dose segue a dose mais recente (fase atual)
      const nextPlannedMg = last.mg;
      const nextMgEl = document.getElementById("next-mg");
      nextMgEl.textContent = formatMg(nextPlannedMg);
      nextMgEl.className = mgClass(nextPlannedMg);

      const today = new Date();
      const daysDiff = diffDays(today, nextDateObj);

      const countdown = document.getElementById("next-countdown");
      if (daysDiff === 0) countdown.textContent = "A próxima dose é hoje.";
      else if (daysDiff > 0) countdown.textContent = `Faltam ${daysDiff} dia${daysDiff === 1 ? "" : "s"} para a próxima dose.`;
      else countdown.textContent = `A data prevista já passou há ${Math.abs(daysDiff)} dia${Math.abs(daysDiff) === 1 ? "" : "s"}.`;
    }

    // ====================================
    // RENDER: TABELA
    // ====================================
    function renderTable(){
      const tbody = document.getElementById("dose-tbody");
      const footer = document.getElementById("table-footer");

      if (!doses.length){
        tbody.innerHTML = "";
        footer.textContent = "Nenhuma dose registrada ainda.";
        return;
      }

      tbody.innerHTML = "";

      doses.forEach(d => {
        const tr = document.createElement("tr");

        const tdId = document.createElement("td");
        tdId.className = "dose-id";
        tdId.textContent = `${String(d.id).padStart(2, "0")}ª`;
        tr.appendChild(tdId);

        const tdDate = document.createElement("td");
        tdDate.textContent = formatDatePtBR(d.date);
        tr.appendChild(tdDate);

        const tdWeekday = document.createElement("td");
        const wdSpan = document.createElement("span");
        wdSpan.className = "weekday-tag";
        wdSpan.textContent = d.weekday;
        tdWeekday.appendChild(wdSpan);
        tr.appendChild(tdWeekday);

        const tdMg = document.createElement("td");
        const mgSpan = document.createElement("span");
        mgSpan.className = "mg-pill " + mgClass(d.mg);
        mgSpan.textContent = formatMg(d.mg);
        tdMg.appendChild(mgSpan);
        tr.appendChild(tdMg);

        const tdNote = document.createElement("td");
        tdNote.className = "note";
        tdNote.textContent = d.note || "";
        tr.appendChild(tdNote);

        tbody.appendChild(tr);
      });

      const first = doses[0];
      const last = doses[doses.length - 1];
      footer.textContent =
        `Linha do tempo de ${formatDatePtBR(first.date)} até ${formatDatePtBR(last.date)} · ${doses.length} dose(s) registrada(s).`;
    }

    // ====================================
    // INIT
    // ====================================
    renderWeights();
    renderSummary();
    renderTable();
  </script>
</body>
</html>
